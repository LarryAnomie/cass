/*! cassrmain 23-10-2013 */
!function(a){a.fn.wrapChildren=function(b){var b=a.extend({childElem:void 0,sets:1,wrapper:"div"},b||{});return void 0===b.childElem?this:this.each(function(){var c=a(this).children(b.childElem),d=[];c.each(function(e,f){if(d.push(f),0===(e+1)%b.sets||e===c.length-1){var g=a(d);d=[],g.wrapAll(a("<"+b.wrapper+">"))}})})}}(jQuery),function(a){var b={},c={mode:"horizontal",slideSelector:"",infiniteLoop:!0,hideControlOnEnd:!1,speed:500,easing:null,slideMargin:0,startSlide:0,randomStart:!1,captions:!1,ticker:!1,tickerHover:!1,adaptiveHeight:!1,adaptiveHeightSpeed:500,touchEnabled:!0,swipeThreshold:50,video:!1,useCSS:!0,pager:!0,pagerType:"full",pagerShortSeparator:" / ",pagerSelector:null,buildPager:null,pagerCustom:null,controls:!0,nextText:"Next",prevText:"Prev",nextSelector:null,prevSelector:null,autoControls:!1,startText:"Start",stopText:"Stop",autoControlsCombine:!1,autoControlsSelector:null,auto:!1,pause:4e3,autoStart:!0,autoDirection:"next",autoHover:!1,autoDelay:0,minSlides:1,maxSlides:1,moveSlides:0,slideWidth:0,onSliderLoad:function(){},onSlideBefore:function(){},onSlideAfter:function(){},onSlideNext:function(){},onSlidePrev:function(){}};a.fn.bxSlider=function(d){if(0!=this.length){if(this.length>1)return this.each(function(){a(this).bxSlider(d)}),this;var e={},f=this;b.el=this;var g=function(){e.settings=a.extend({},c,d),e.children=f.children(e.settings.slideSelector),e.settings.randomStart&&(e.settings.startSlide=Math.floor(Math.random()*e.children.length)),e.active={index:e.settings.startSlide},e.carousel=e.settings.minSlides>1||e.settings.maxSlides>1,e.minThreshold=e.settings.minSlides*e.settings.slideWidth+(e.settings.minSlides-1)*e.settings.slideMargin,e.maxThreshold=e.settings.maxSlides*e.settings.slideWidth+(e.settings.maxSlides-1)*e.settings.slideMargin,e.working=!1,e.controls={},e.animProp="vertical"==e.settings.mode?"top":"left",e.usingCSS=e.settings.useCSS&&"fade"!=e.settings.mode&&function(){var a=document.createElement("div"),b=["WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var c in b)if(void 0!==a.style[b[c]])return e.cssPrefix=b[c].replace("Perspective","").toLowerCase(),e.animProp="-"+e.cssPrefix+"-transform",!0;return!1}(),"vertical"==e.settings.mode&&(e.settings.maxSlides=e.settings.minSlides),h()},h=function(){if(f.wrap('<div class="bx-wrapper"><div class="bx-viewport"></div></div>'),e.viewport=f.parent(),e.loader=a('<div class="bx-loading" />'),e.viewport.prepend(e.loader),f.css({width:"horizontal"==e.settings.mode?215*e.children.length+"%":"auto",position:"relative"}),e.usingCSS&&e.settings.easing?f.css("-"+e.cssPrefix+"-transition-timing-function",e.settings.easing):e.settings.easing||(e.settings.easing="swing"),e.viewport.css({width:"100%",overflow:"hidden",position:"relative"}),e.children.css({"float":"horizontal"==e.settings.mode?"left":"none",listStyle:"none"}),e.children.width(k()),"horizontal"==e.settings.mode&&e.settings.slideMargin>0&&e.children.css("marginRight",e.settings.slideMargin),"vertical"==e.settings.mode&&e.settings.slideMargin>0&&e.children.css("marginBottom",e.settings.slideMargin),"fade"==e.settings.mode&&(e.children.css({position:"absolute",zIndex:0,display:"none"}),e.children.eq(e.settings.startSlide).css({zIndex:50,display:"block"})),e.controls.el=a('<div class="bx-controls" />'),e.settings.captions&&u(),e.settings.infiniteLoop&&"fade"!=e.settings.mode&&!e.settings.ticker){var b="vertical"==e.settings.mode?e.settings.minSlides:e.settings.maxSlides,c=e.children.slice(0,b).clone().addClass("bx-clone"),d=e.children.slice(-b).clone().addClass("bx-clone");f.append(c).prepend(d)}e.active.last=e.settings.startSlide==m()-1,e.settings.video&&f.fitVids(),e.settings.ticker||(e.settings.pager&&r(),e.settings.controls&&s(),e.settings.auto&&e.settings.autoControls&&t(),(e.settings.controls||e.settings.autoControls||e.settings.pager)&&e.viewport.after(e.controls.el)),f.children().imagesLoaded(function(){e.loader.remove(),o(),"vertical"==e.settings.mode&&(e.settings.adaptiveHeight=!0),e.viewport.height(j()),e.settings.onSliderLoad(e.active.index),e.settings.auto&&e.settings.autoStart&&E(),e.settings.ticker&&F(),e.settings.pager&&A(e.settings.startSlide),e.settings.controls&&D(),e.settings.touchEnabled&&!e.settings.ticker&&H()})},j=function(){var b=0,c=a();if("vertical"==e.settings.mode||e.settings.adaptiveHeight)if(e.carousel){var d=1==e.settings.moveSlides?e.active.index:e.active.index*n();for(c=e.children.eq(d),i=1;i<=e.settings.maxSlides-1;i++)c=d+i>=e.children.length?c.add(e.children.eq(i-1)):c.add(e.children.eq(d+i))}else c=e.children.eq(e.active.index);else c=e.children;return"vertical"==e.settings.mode?(c.each(function(){b+=a(this).outerHeight()}),e.settings.slideMargin>0&&(b+=e.settings.slideMargin*(e.settings.minSlides-1))):b=Math.max.apply(Math,c.map(function(){return a(this).outerHeight(!1)}).get()),b},k=function(){var a=e.settings.slideWidth,b=e.viewport.width();return 0==e.settings.slideWidth?a=b:b>e.maxThreshold?a=(b-e.settings.slideMargin*(e.settings.maxSlides-1))/e.settings.maxSlides:b<e.minThreshold&&(a=(b-e.settings.slideMargin*(e.settings.minSlides-1))/e.settings.minSlides),a},l=function(){var a=1;if("horizontal"==e.settings.mode)if(e.viewport.width()<e.minThreshold)a=e.settings.minSlides;else if(e.viewport.width()>e.maxThreshold)a=e.settings.maxSlides;else{var b=e.children.first().width();a=Math.floor(e.viewport.width()/b)}else"vertical"==e.settings.mode&&(a=e.settings.minSlides);return a},m=function(){var a=0;if(e.settings.moveSlides>0)if(e.settings.infiniteLoop)a=e.children.length/n();else for(var b=0,c=0;b<e.children.length;)++a,b=c+l(),c+=e.settings.moveSlides<=l()?e.settings.moveSlides:l();else a=Math.ceil(e.children.length/l());return a},n=function(){return e.settings.moveSlides>0&&e.settings.moveSlides<=l()?e.settings.moveSlides:l()},o=function(){if(e.active.last){if("horizontal"==e.settings.mode){var a=e.children.last(),b=a.position();p(-(b.left-(e.viewport.width()-a.width())),"reset",0)}else if("vertical"==e.settings.mode){var c=e.children.length-e.settings.minSlides,b=e.children.eq(c).position();p(-b.top,"reset",0)}}else{var b=e.children.eq(e.active.index*n()).position();e.active.index==m()-1&&(e.active.last=!0),void 0!=b&&("horizontal"==e.settings.mode?p(-b.left,"reset",0):"vertical"==e.settings.mode&&p(-b.top,"reset",0))}},p=function(a,b,c,d){if(e.usingCSS){var g="vertical"==e.settings.mode?"translate3d(0, "+a+"px, 0)":"translate3d("+a+"px, 0, 0)";f.css("-"+e.cssPrefix+"-transition-duration",c/1e3+"s"),"slide"==b?(f.css(e.animProp,g),f.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){f.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),B()})):"reset"==b?f.css(e.animProp,g):"ticker"==b&&(f.css("-"+e.cssPrefix+"-transition-timing-function","linear"),f.css(e.animProp,g),f.bind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd",function(){f.unbind("transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd"),p(d.resetValue,"reset",0),G()}))}else{var h={};h[e.animProp]=a,"slide"==b?f.animate(h,c,e.settings.easing,function(){B()}):"reset"==b?f.css(e.animProp,a):"ticker"==b&&f.animate(h,speed,"linear",function(){p(d.resetValue,"reset",0),G()})}},q=function(){var b="";pagerQty=m();for(var c=0;pagerQty>c;c++){var d="";e.settings.buildPager&&a.isFunction(e.settings.buildPager)?(d=e.settings.buildPager(c),e.pagerEl.addClass("bx-custom-pager")):(d=c+1,e.pagerEl.addClass("bx-default-pager")),b+='<div class="bx-pager-item"><a href="" data-slide-index="'+c+'" class="bx-pager-link">'+d+"</a></div>"}e.pagerEl.html(b)},r=function(){e.settings.pagerCustom?e.pagerEl=a(e.settings.pagerCustom):(e.pagerEl=a('<div class="bx-pager" />'),e.settings.pagerSelector?a(e.settings.pagerSelector).html(e.pagerEl):e.controls.el.addClass("bx-has-pager").append(e.pagerEl),q()),e.pagerEl.delegate("a","click",z)},s=function(){e.controls.next=a('<a class="bx-next" href="">'+e.settings.nextText+"</a>"),e.controls.prev=a('<a class="bx-prev" href="">'+e.settings.prevText+"</a>"),e.controls.next.bind("click",v),e.controls.prev.bind("click",w),e.settings.nextSelector&&a(e.settings.nextSelector).append(e.controls.next),e.settings.prevSelector&&a(e.settings.prevSelector).append(e.controls.prev),e.settings.nextSelector||e.settings.prevSelector||(e.controls.directionEl=a('<div class="bx-controls-direction" />'),e.controls.directionEl.append(e.controls.prev).append(e.controls.next),e.controls.el.addClass("bx-has-controls-direction").append(e.controls.directionEl))},t=function(){e.controls.start=a('<div class="bx-controls-auto-item"><a class="bx-start" href="">'+e.settings.startText+"</a></div>"),e.controls.stop=a('<div class="bx-controls-auto-item"><a class="bx-stop" href="">'+e.settings.stopText+"</a></div>"),e.controls.autoEl=a('<div class="bx-controls-auto" />'),e.controls.autoEl.delegate(".bx-start","click",x),e.controls.autoEl.delegate(".bx-stop","click",y),e.settings.autoControlsCombine?e.controls.autoEl.append(e.controls.start):e.controls.autoEl.append(e.controls.start).append(e.controls.stop),e.settings.autoControlsSelector?a(e.settings.autoControlsSelector).html(e.controls.autoEl):e.controls.el.addClass("bx-has-controls-auto").append(e.controls.autoEl),C(e.settings.autoStart?"stop":"start")},u=function(){e.children.each(function(){var b=a(this).find("img:first").attr("title");void 0!=b&&a(this).append('<div class="bx-caption"><span>'+b+"</span></div>")})},v=function(a){e.settings.auto&&f.stopAuto(),f.goToNextSlide(),a.preventDefault()},w=function(a){e.settings.auto&&f.stopAuto(),f.goToPrevSlide(),a.preventDefault()},x=function(a){f.startAuto(),a.preventDefault()},y=function(a){f.stopAuto(),a.preventDefault()},z=function(b){e.settings.auto&&f.stopAuto();var c=a(b.currentTarget),d=parseInt(c.attr("data-slide-index"));d!=e.active.index&&f.goToSlide(d),b.preventDefault()},A=function(a){return"short"==e.settings.pagerType?(e.pagerEl.html(a+1+e.settings.pagerShortSeparator+e.children.length),void 0):(e.pagerEl.find("a").removeClass("active"),e.pagerEl.find("a").eq(a).addClass("active"),void 0)},B=function(){if(e.settings.infiniteLoop){var a="";0==e.active.index?a=e.children.eq(0).position():e.active.index==m()-1&&e.carousel?a=e.children.eq((m()-1)*n()).position():e.active.index==e.children.length-1&&(a=e.children.eq(e.children.length-1).position()),"horizontal"==e.settings.mode?p(-a.left,"reset",0):"vertical"==e.settings.mode&&p(-a.top,"reset",0)}e.working=!1,e.settings.onSlideAfter(e.children.eq(e.active.index),e.oldIndex,e.active.index)},C=function(a){e.settings.autoControlsCombine?e.controls.autoEl.html(e.controls[a]):(e.controls.autoEl.find("a").removeClass("active"),e.controls.autoEl.find("a:not(.bx-"+a+")").addClass("active"))},D=function(){!e.settings.infiniteLoop&&e.settings.hideControlOnEnd&&(0==e.active.index?(e.controls.prev.addClass("disabled"),e.controls.next.removeClass("disabled")):e.active.index==m()-1?(e.controls.next.addClass("disabled"),e.controls.prev.removeClass("disabled")):(e.controls.prev.removeClass("disabled"),e.controls.next.removeClass("disabled")))},E=function(){e.settings.autoDelay>0?setTimeout(f.startAuto,e.settings.autoDelay):f.startAuto(),e.settings.autoHover&&f.hover(function(){e.interval&&(f.stopAuto(!0),e.autoPaused=!0)},function(){e.autoPaused&&(f.startAuto(!0),e.autoPaused=null)})},F=function(){var b=0;if("next"==e.settings.autoDirection)f.append(e.children.clone().addClass("bx-clone"));else{f.prepend(e.children.clone().addClass("bx-clone"));var c=e.children.first().position();b="horizontal"==e.settings.mode?-c.left:-c.top}p(b,"reset",0),e.settings.pager=!1,e.settings.controls=!1,e.settings.autoControls=!1,e.settings.tickerHover&&!e.usingCSS&&e.viewport.hover(function(){f.stop()},function(){var b=0;e.children.each(function(){b+="horizontal"==e.settings.mode?a(this).outerWidth(!0):a(this).outerHeight(!0)});var c=e.settings.speed/b,d="horizontal"==e.settings.mode?"left":"top",g=c*(b-Math.abs(parseInt(f.css(d))));G(g)}),G()},G=function(a){speed=a?a:e.settings.speed;var b={left:0,top:0},c={left:0,top:0};"next"==e.settings.autoDirection?b=f.find(".bx-clone").first().position():c=e.children.first().position();var d="horizontal"==e.settings.mode?-b.left:-b.top,g="horizontal"==e.settings.mode?-c.left:-c.top,h={resetValue:g};p(d,"ticker",speed,h)},H=function(){e.touch={start:{x:0,y:0},end:{x:0,y:0}},e.viewport.bind("touchstart",I)},I=function(a){if(e.working)a.preventDefault();else{e.touch.originalPos=f.position();var b=a.originalEvent;e.touch.start.x=b.changedTouches[0].pageX,e.touch.start.y=b.changedTouches[0].pageY,e.viewport.bind("touchmove",J),e.viewport.bind("touchend",K)}},J=function(a){if(a.preventDefault(),"fade"!=e.settings.mode){var b=a.originalEvent,c=0;if("horizontal"==e.settings.mode){var d=b.changedTouches[0].pageX-e.touch.start.x;c=e.touch.originalPos.left+d}else{var d=b.changedTouches[0].pageY-e.touch.start.y;c=e.touch.originalPos.top+d}p(c,"reset",0)}},K=function(a){e.viewport.unbind("touchmove",J);var b=a.originalEvent,c=0;if(e.touch.end.x=b.changedTouches[0].pageX,e.touch.end.y=b.changedTouches[0].pageY,"fade"==e.settings.mode){var d=Math.abs(e.touch.start.x-e.touch.end.x);d>=e.settings.swipeThreshold&&(e.touch.start.x>e.touch.end.x?f.goToNextSlide():f.goToPrevSlide(),f.stopAuto())}else{var d=0;"horizontal"==e.settings.mode?(d=e.touch.end.x-e.touch.start.x,c=e.touch.originalPos.left):(d=e.touch.end.y-e.touch.start.y,c=e.touch.originalPos.top),!e.settings.infiniteLoop&&(0==e.active.index&&d>0||e.active.last&&0>d)?p(c,"reset",200):Math.abs(d)>=e.settings.swipeThreshold?(0>d?f.goToNextSlide():f.goToPrevSlide(),f.stopAuto()):p(c,"reset",200)}e.viewport.unbind("touchend",K)};f.goToSlide=function(b,c){if(!e.working&&e.active.index!=b)if(e.working=!0,e.oldIndex=e.active.index,e.active.index=0>b?m()-1:b>=m()?0:b,e.settings.onSlideBefore(e.children.eq(e.active.index),e.oldIndex,e.active.index),"next"==c?e.settings.onSlideNext(e.children.eq(e.active.index),e.oldIndex,e.active.index):"prev"==c&&e.settings.onSlidePrev(e.children.eq(e.active.index),e.oldIndex,e.active.index),e.active.last=e.active.index>=m()-1,e.settings.pager&&A(e.active.index),e.settings.controls&&D(),"fade"==e.settings.mode)e.settings.adaptiveHeight&&e.viewport.height()!=j()&&e.viewport.animate({height:j()},e.settings.adaptiveHeightSpeed),e.children.filter(":visible").fadeOut(e.settings.speed).css({zIndex:0}),e.children.eq(e.active.index).css("zIndex",51).fadeIn(e.settings.speed,function(){a(this).css("zIndex",50),B()});else{e.settings.adaptiveHeight&&e.viewport.height()!=j()&&e.viewport.animate({height:j()},e.settings.adaptiveHeightSpeed);var d=0,g={left:0,top:0};if(!e.settings.infiniteLoop&&e.carousel&&e.active.last)if("horizontal"==e.settings.mode){var h=e.children.eq(e.children.length-1);g=h.position(),d=e.viewport.width()-h.width()}else{var i=e.children.length-e.settings.minSlides;g=e.children.eq(i).position()}else if(e.carousel&&e.active.last&&"prev"==c){var k=1==e.settings.moveSlides?e.settings.maxSlides-n():(m()-1)*n()-(e.children.length-e.settings.maxSlides),h=f.children(".bx-clone").eq(k);g=h.position()}else if("next"==c&&0==e.active.index)g=f.find(".bx-clone").eq(e.settings.maxSlides).position(),e.active.last=!1;else if(b>=0){var l=b*n();g=e.children.eq(l).position()}var o="horizontal"==e.settings.mode?-(g.left-d):-g.top;p(o,"slide",e.settings.speed)}},f.goToNextSlide=function(){if(e.settings.infiniteLoop||!e.active.last){var a=e.active.index+1;f.goToSlide(a,"next")}},f.goToPrevSlide=function(){if(e.settings.infiniteLoop||0!=e.active.index){var a=e.active.index-1;f.goToSlide(a,"prev")}},f.startAuto=function(a){e.interval||(e.interval=setInterval(function(){"next"==e.settings.autoDirection?f.goToNextSlide():f.goToPrevSlide()},e.settings.pause),e.settings.autoControls&&1!=a&&C("stop"))},f.stopAuto=function(a){e.interval&&(clearInterval(e.interval),e.interval=null,e.settings.autoControls&&1!=a&&C("start"))},f.getCurrentSlide=function(){return e.active.index},f.getSlideCount=function(){return e.children.length};var L=a(window).width(),M=a(window).height();return a(window).resize(function(){var b=a(window).width(),c=a(window).height();(L!=b||M!=c)&&(L=b,M=c,e.children.add(f.find(".bx-clone")).width(k()),e.viewport.css("height",j()),e.active.last&&(e.active.index=m()-1),e.active.index>=m()&&(e.active.last=!0),e.settings.pager&&!e.settings.pagerCustom&&(q(),A(e.active.index)),e.settings.ticker||o())}),g(),this}}}(jQuery),function(a,b){var c="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";a.fn.imagesLoaded=function(d){function e(){var b=a(l),c=a(m);h&&(m.length?h.reject(j,b,c):h.resolve(j)),a.isFunction(d)&&d.call(g,j,b,c)}function f(b,d){b.src===c||-1!==a.inArray(b,k)||(k.push(b),d?m.push(b):l.push(b),a.data(b,"imagesLoaded",{isBroken:d,src:b.src}),i&&h.notifyWith(a(b),[d,j,a(l),a(m)]),j.length===k.length&&(setTimeout(e),j.unbind(".imagesLoaded")))}var g=this,h=a.isFunction(a.Deferred)?a.Deferred():0,i=a.isFunction(h.notify),j=g.find("img").add(g.filter("img")),k=[],l=[],m=[];return a.isPlainObject(d)&&a.each(d,function(a,b){"callback"===a?d=b:h&&h[a](b)}),j.length?j.bind("load.imagesLoaded error.imagesLoaded",function(a){f(a.target,"error"===a.type)}).each(function(d,e){var g=e.src,h=a.data(e,"imagesLoaded");h&&h.src===g?f(e,h.isBroken):e.complete&&e.naturalWidth!==b?f(e,0===e.naturalWidth||0===e.naturalHeight):(e.readyState||e.complete)&&(e.src=c,e.src=g)}):e(),h?h.promise(g):g}}(jQuery);var _gaq=_gaq||[],CASS=function(a,b,c){"use strict";var d,e={googleAnalytics:{description:"google Analytics tracking code",src:"lib/ga.js",async:!0},flowplayer:{description:"include flowplayer for pages with videos",src:"lib/flowplayer/flowplayer-3.2.4.min.js"},flowplayerEmbed:{description:"Embed code for flowplayer",src:"lib/flowplayer/flowplayer.embed-3.0.3.min.js"},swfobject:{description:"swfobject for youtube video(s)",src:"lib/swfobject/swfobject.js"},galleria:{description:"JQuery image gallery plugin",src:"lib/jquery/plugins/galleria/galleria-1.2.9/galleria-1.2.9.min.js"},galleriaTheme:{description:"city galleria theme",src:"lib/jquery/plugins/galleria/themes/city/galleria.city.min.js"},highcharts:{description:"JQuery charting plugin",src:"lib/jquery/plugins/highcharts/highcharts.js"},shadowbox:{description:"script to display a modal window",src:"lib/shadowbox/shadowbox.js"}},f=0,g=a.location,h="//"+g.hostname.replace(/www|intranet/,"s1").replace("cass.","")+"/cassrmain/js/",i=null,j=a.CITY_VERSION||"123456789.",k=-1!==g.hostname.indexOf("cass.city.ac.uk"),l=-1!==g.hostname.indexOf("bunhill.city.ac.uk"),m={thin:320,medium:768,thinish:480,wide:980,wider:1200},n=function(b){var c,d;if(f>0||location.search.match("debug"))try{a.console.log(b)}catch(e){try{opera.postError.apply(opera,b)}catch(g){c=document.getElementById("debugContainer"),c||(c=document.createElement("div"),c.setAttribute("id","debugContainer"),c.setAttribute("class","hide"),document.getElementsByTagName("body").item(0).appendChild(c)),d=document.createElement("pre"),d.setAttribute("class","debug"),d.appendChild(document.createTextNode(b)),c.appendChild(d)}}},o=function(a,b){var d=function(){var b=e[a];return/^https?:\/\//.test(b.src)?b.src:h+(/plugins|lib/.test(b.src)?"":"modules/")+b.src}();c({load:d,callback:b})},p=function(a){j=a},q=function(a){i=a},r=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&(c+=1);return c},s=function(a){return 0===a%2?!0:!1},t=function(){var a,b=[],c=0,d=g.href.slice(g.href.indexOf("?")+1).split("&");for(c;c<d.length;c+=1)a=d[c].split("="),b.push(a[0]),b[a[0]]=a[1];return b},u=function(a){return Math.round($(a).width())},v=function(){var b=!1,c=a.document.documentElement,d=20,e=Date.now?Date.now():function(){return(new Date).valueOf()}();return a.viewport=a.viewport||{},a.viewport.dimensions=a.viewport.dimensions||{height:null,width:null},a.viewport.timeStamp&&e-a.viewport.timeStamp<d?(n("within window, returning "+a.viewport.storedResult),a.viewport.storedResult):(a.viewport.timeStamp=e,(a.viewport.dimensions.width!==c.clientWidth||a.viewport.dimensions.height!==c.clientHeight)&&(b=!0),a.viewport.dimensions.height=c.clientHeight,a.viewport.dimensions.width=c.clientWidth,a.viewport.storedResult=b,n("viewport changed: "+b),b)},w=function(){Shadowbox.init()},x=function(a){var b=a.children().length,c=function(){var b={auto:!0,autoControls:!0,pause:15e3,autoHover:!0,touchEnabled:!1,mode:"fade",startText:'<i class="icon-play"></i>',stopText:'<i class="icon-pause"></i>',nextText:'<i class="icon-caret-right"></i>',prevText:'<i class="icon-caret-left"></i>',adaptiveHeight:!0};a.bxSlider(b),a.removeClass("loading")};b>1&&(CASS.debug("more than 1 slide, need carousel. NumSlides ="+b),c(a))},y=function(a){var b,d={src:"/apis/galleries/galleria-json?root=",root:""},e=$('<span class="loading">loading</span>'),f={height:.5625,lightbox:!1,maxScaleRatio:1,preload:2,showInfo:!1,imageCrop:!1,debug:!0,extend:function(){"city"===a.attr("data-theme")&&(a.prepend($("<div/>",{"class":"cg-caption"})),this.bind("loadstart",function(b){var c=this._data[b.index],d=a.find(".cg-caption");c.m_caption?d.html(c.m_caption):d.html("&nbsp;")}))}},g=function(){return d.root=a.attr("id").replace("gallery-",""),$.getJSON(d.src+d.root,function(c){e.hide(),a.css("opacity","1"),f.data_source=c,b.galleria(f)}),b};return a&&0!==a.length?(b=a.find(".gallery-inner"),0===b.length?(n("no stage found"),void 0):(b.hasClass("lightbox")&&(f.lightbox=!0),b.hasClass("caption")&&(f.showInfo=!0),a.prepend(e),c({load:["lib/jquery/plugins/galleria/galleria-1.2.9/galleria-1.2.9.min.js","lib/jquery/plugins/galleria/galleria-1.2.9/themes/city/galleria.city.js"],complete:g}),void 0)):(n("$gallery is undefined or not a jQuery object"),void 0)},z=function(){if(!i)return n("need to call CASS.setGaAccount(), before initialising google analytics"),void 0;var a="//www.google-analytics.com/plugins/ga/inpage_linkid.js";_gaq.push(["_require","inpage_linkid",a]),_gaq.push(["_setAccount",i]),CASS.isCass?(CASS.isCass||CASS.isBunhill)&&(_gaq.push(["_setDomainName",".city.ac.uk"]),_gaq.push(["_setAllowedLinker","true"])):_gaq.push(["_setDomainName",".city.ac.uk"]),_gaq.push(["_trackPageview"]),_gaq.push(["_trackPageLoadTime"]),o("googleAnalytics")},A=function(a,b,c){b.autocomplete({source:function(a,b){$.ajax({url:"/mirror/fb-prod/padre-qs-core.cgi?collection="+c+"&fmt=json",dataType:"json",data:{partial_query:a.term},success:function(a){b($.map(a,function(a){return{label:a}}))}})},minLength:2,delay:20,select:function(b,c){this.close,$(this).val(c.item.value),a.submit()},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}})},B=function(){var a=$("img.youtube"),b=$("img.fms"),d=function(a){a.each(function(a,b){var c=$(b),d=500,e=320,f=c.attr("id").replace("vid_","");c.replaceWith('<div class="embed-wrapper"><div class="embed-container"><iframe height='+e+" width= "+d+' src="http://www.youtube.com/embed/'+f+"?rel=0\" frameborder='0' allowfullscreen></iframe></div></div>")})},f=function(a){var b={cassStandard:"//s1.city.ac.uk/i/flowplayer-cass.jpg",cassRetina:"",cityStandard:"//s1.city.ac.uk/i/flowplayer-city.jpg?v=8101",cityRentina:""};a.each(function(a,c){var d=$(c),e=687,f=419,g=d.attr("id"),h=g.replace("vid_",""),i="//s1.city.ac.uk/js/swfobject/expressInstall.swf",j="9.0.28",k=null,l={allowScriptAccess:"always",allowfullscreen:"true",wmode:"transparent"},m=CITY.isCass?b.cassStandard:b.cityStandard,n=function(a){$(a.ref).wrap('<div class="embed-wrapper" style="width:'+e+'px"><div class="embed-container"></div></div>')};0!==d.parents(".course-description").length&&(e=419),d.hasClass("widescreen")?f=.61*e:(e=500,f=320),swfobject.hasFlashPlayerVersion(j)?(k="{'clip': {'provider': 'rtmp'}, 'playlist': [{'url':'"+m+"', 'autoPlay': true}, {'url': '"+h.replace("vid_","")+"/Hi_bandwidth', 'autoPlay': false, 'scaling': 'fit'}], 'plugins': {'rtmp': {'url': 'http://s1.city.ac.uk/js/flowplayer/flowplayer.rtmp-3.2.3.swf', 'netConnectionUrl': 'rtmp://media.city.ac.uk/flowplayer', 'objectEncoding': '0', 'proxyType': 'none' }, 'controls': {'url': 'flowplayer.controls.swf'} } }",swfobject.embedSWF("http://s1.city.ac.uk/js/flowplayer/flowplayer-3.2.6.swf",g,e,f,"9.0.0",i,{config:k},l,!1,n)):d.after('<p class="notice-message"><i class="icon-warning-sign" style="color : #CCCC00"></i> You need to have flash player '+j+" or greater installed to see the video.</p>"+'<p><a href="http://get.adobe.com/flashplayer/">Get Flash Player</a></p>')})};a.length&&d(a),b.length&&c({load:e.swfobject.src,callback:function(){f(b)}})},C=function(a){var b,c,d,e=function(a){return this instanceof e?(this.el=a,this.$el=$(a),this.player=$("#yt-video-player"),this.tmpl=['<div class="span14">','<div id="yt-video-player" class="yt-video-player">','<div class="embed-wrapper">','<div class="embed-container">','<iframe src="http://www.youtube.com/embed/<%= data.id %>?rel=0" frameborder="0" allowfullscreen></iframe>',"</div>","</div>","</div>","</div>",'<div class="span10">','<div class="video-meta">','<h2 class="video-title"><%= data.title %></h2>','<p class="video-description"><%= data.description %></p>','<p class="video-views">Views : <%= data.views %></p>','<p class="social-flat-links">','<span class="facebook social-btn"><a href="https://www.facebook.com/dialog/feed?app_id=141996839165515&amp;redirect_uri=<% window.location.href %>&amp;link=<%= data.player %>"><i class="icon-facebook"></i>Facebook</a></span>','<span class="twitter social-btn"><a href="https://twitter.com/intent/tweet?url=<%= data.player %>&amp;title=<%= data.title %>"><i class="icon-twitter"></i>Twitter</a></span>','<span class="google social-btn"><a href="https://plus.google.com/share?url=<%= data.player %>"><i class="icon-google-plus"></i>Google +</a></span>',"</p>","</div>","<div>"].join("\n"),this):new e(a)},f=function(a){return this instanceof f?(this.el=a,this.$el=$(a),this.tmpl=['<li data-video-id="<%= data.id %>" data-video-title="<%= data.title %>" data-video-description="<%= data.description %>" data-video-player="<%= data.player %>" data-video-views="<%= data.views %>" class="video event event-video <%= data.activeClass %>">','<a href="http://www.youtube.com/embed/<%= data.id %>" class="video-link">','<img src="<%= data.thumbnail %>" />',"</a>",'<p class="video-title">','<a href="http://www.youtube.com/embed/<%= data.id %>" class="video-link"><%= data.title %></a>',"</p>",'<p class="video-views"><span class="view-count"><%= data.views %></span> views</p>',"</li>"].join("\n"),this):new f(a)};return e.prototype.update=function(a){var b=_.template(this.tmpl,a,{variable:"data"});this.$el.addClass("loading").empty().append(b).removeClass("loading")},f.prototype.buildList=function(a){this.$el.append('<ul class="yt-videos-list">'+a.join("")+"</ul>"),this.videoLinks=this.$el.find(".video-link"),this.$el.on("click",".video-link",function(a){var b=$(this),c=b.parents(".video"),e={};a.preventDefault(),e.title=c.data("video-title"),e.description=c.data("video-description"),e.views=c.data("video-views"),e.src=b.attr("href"),e.id=c.data("video-id"),e.player=c.data("video-player"),$(".video-link").each(function(){$(this).parent(".video").removeClass("active")}),c.addClass("active"),d.update(e),$("html, body").animate({scrollTop:$("#yt-video-player").offset().top},500)}),this.$el.find("ul").bxSlider({slideWidth:200,minSlides:2,maxSlides:10,slideMargin:10,moveSlides:1,infiniteLoop:!0,nextText:'<i class="icon-caret-right"></i>',prevText:'<i class="icon-caret-left"></i>',touchEnabled:!0,preventDefaultSwipeY:!0,adaptiveHeight:!0})},window._?(a=a||$("#yt-module"),d=new e("#yt-featured-video"),c=new f("#yt-videos-list"),(b=a.data("yt-playlist"))?($.ajax({url:b,dataType:"jsonp",success:function(a){var b,e,f,g=a.data.items,h=g.length,i=[];for(f=0;h>f;f++)g[f].video.thumbnail&&(e={title:g[f].video.title,description:g[f].video.description,views:g[f].video.viewCount,id:g[f].video.id,player:encodeURI(g[f].video.player["default"]),thumbnail:g[f].video.thumbnail.hqDefault,activeClass:""},0===f?(e.activeClass="active",d.update(e)):e.activeClass="",b=_.template(c.tmpl,e,{variable:"data"}),i[f]=b);c.buildList(i)},complete:function(){a.removeClass("loading")},error:function(a,b,c){CASS.debug(a,b,c)}}),void 0):(CASS.debug("Needs a YouTube playlist"),void 0)):(CASS.debug("ytModule requires Underscore.js to be loaded"),void 0)},D=function(){var a="//webapps.city.ac.uk/matrix/services/jQueryError.php",b=function(b,c,d,e){$("<img />",{src:a+"?u="+escape(g.href)+"&s="+escape(d.url)+"&t="+d.type+"&e="+escape(e),style:"display: none"}).appendTo("#footer")};$(document).ajaxError(b)},E=function(a,b,c){var d='<i class="icon-caret-left"></i>',e='<i class="icon-caret-right"></i>',f=a.find(".bx-prev"),g=a.find(".bx-next"),h=c?c:"All";f.empty().append(d),g.empty().append(e),b&&f.after('<a href="'+b+'" class="bx-all" >'+h+"</a>"),a.find(".bx-controls-direction").appendTo(a),a.find(".widget-content").addClass("scrollable"),a.removeClass("widget-loading")},F=function(){var a=$("#news-widget"),b=a.find("#news-results"),c="//www.cass.ac.uk/news",d=3;b.find("> .article").size()>d?(b.wrapChildren({childElem:".article",sets:d}),b.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){E(a,c)}})):a.removeClass("widget-loading")},G=function(){var a=$("#events-widget"),b=a.find("#events-results"),c="//www.cass.ac.uk/events",d=3;$(b).on("click",".vevent",function(){return window.location=$(this).find("a").attr("href"),!1}),b.find("> .vevent").size()>d?(b.wrapChildren({childElem:".event",sets:d}),b.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){E(a,c)}})):a.removeClass("widget-loading")},H=function(){var a,b=$("#flickr-widget"),c=b.find("ul"),d=function(){n("flickr callback..."),$(".widget-content",b).each(function(){var a=$("ul div:first-child",this),c=$(this),d=a.height(),e=a.width();c.addClass("scrollable"),c.stop().animate({"min-height":d}),c.css("width",e),b.removeClass("widget-loading")}),E(b)};b.mouseenter(function(){a||(a=!0,$("a .imageurl",b).each(function(){var a=$(this),b=a.text(),c='<img src="'+b+'" alt="">';a.parent().text("").prepend(c)}),$("p .imageurl",b).each(function(){var a=$(this),b=a.text(),c="background-image: url("+b+");";a.parent().attr("style",c),a.remove()}))}),c.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){d()}})},I=function(){var a=$("#courses-widget"),b=a.find(".widget-content");b.accordion({heightStyle:"content",collapsible:!0,active:!1,animate:!1,icons:!1,create:function(){E(a)}})},J=function(){var a,b=$("#testimonials-widget"),c=b.find(".widget-content"),d=c.find("ul");return d.find(".more-opener").remove(),d.find("li").length<2?(n("Less than 2 testimonials, no need for carousel"),b.removeClass("widget-loading"),void 0):(a=function(){E(b),b.removeClass("widget-loading")},d.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){a()}}),void 0)},K=function(){var a,b=$("#profiles-widget"),c=b.find(".widget-content"),d=c.find("ul");return $("li",d).length<2?(n("Less than 2 testimonials, no need for carousel"),b.removeClass("widget-loading"),void 0):(a=function(){E(b),b.removeClass("widget-loading")},d.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){a()}}),void 0)},L=function(){var a=$("#rss-widget"),b=a.find(".widget-content"),c=b.find(".items");c.children().length>1?c.bxSlider({auto:!1,autoControls:!1,pause:15e3,autoHover:!0,touchEnabled:!1,pager:!1,infiniteLoop:!1,hideControlOnEnd:!0,adaptiveHeight:!0,onSliderLoad:function(){E(a)
}}):a.removeClass("widget-loading")},M=function(){var a,b=$("#start_date").val(),c=$("#end_date").val(),d=new Date,e=new Date,f=function(a,b){var c=a.split("/"),d=c[2].split(" ");return b.setFullYear(d[0]),b.setMonth(c[1]-1),b.setDate(c[0]),b};d=f(b,d),e=f(c,e),a=new Date,e>=a&&a>=d?($("#content_on_date").attr("class","widget-content cta-widget-show"),$("#content_out_of_date").attr("class","cta-widget-hide")):($("#content_out_of_date").attr("class","widget-content cta-widget-show"),$("#content_on_date").attr("class","cta-widget-hide"))},N=function(){var a=$("#gallery-widget .gallery");return y(a,!0)},O=function(){var a,b,c={events:{f:G},news:{f:F},flickr:{f:H},courses:{f:I},testimonials:{f:J},rss:{f:L},gallery:{f:N},cta:{f:M},profiles:{f:K}};n("init widget related scripts");for(a in c)if(c.hasOwnProperty(a)){if(b=$("#"+a+"-widget"),0===b.length){n("no "+a+" widget");continue}if("function"!=typeof c[a].f){n("can't find init func of "+a+" widget");continue}n("running init func of "+a+" widget"),c[a].f.apply()}},P=function(){var e=$(a),f=$("body"),g=f.find("#search"),h=g.find("#query"),i="main-all",j=f.find("#global-nav"),k=$(".responsive-toggler"),l=$(".toggle"),n={header:".header",active:!1,collapsible:!0,autoHeight:!0,animate:!1,icons:!1},o=$("#content"),p=$("#promo-area"),q=f.find(".accordion"),r=f.find(".tabs"),s=$(".yt-module"),t=$('a[rel="shadowbox"]'),z=o.find(".gallery");d=u(window)>=m.wide?"wide":"mobile",k.on("click",function(a){var b=$(this),c=b.next(".toggle");a.preventDefault(),b.toggleClass("active"),c.toggleClass("active"),b.hasClass("global-nav-bttn")&&j.accordion("refresh")}),j.find(".dd > a").on("focus",function(a){$(a.target).next(".children").addClass("visible")}),j.find(".dd > a").on("focusout",function(a){$(a.target).next(".children").removeClass("visible")}),"wide"===d||(j.data("ui","accordion"),j.accordion(n)),e.resize(function(){v()&&(u(window)>=m.wide?(d="wide","accordion"===j.data("ui")&&(j.data("ui",""),j.accordion("destroy")),k.removeClass("active"),l.removeClass("active")):(d="mobile",j.data("ui","accordion"),j.accordion(n)))}),q.accordion({heightStyle:"content",collapsible:!0,active:!1,animate:!1,icons:!1}),r.tabs(),0!==p.length&&x(p),0!==z.length&&z.each(function(){y($(this),!1)}),b.input.placeholder||($("[placeholder]").focus(function(){var a=$(this);a.val()===a.attr("placeholder")&&(a.val(""),a.removeClass("placeholder"))}).blur(function(){var a=$(this);(""===a.val()||a.val()===a.attr("placeholder"))&&(a.addClass("placeholder"),a.val(a.attr("placeholder")))}).blur(),$("[placeholder]").parents("form").submit(function(){$(this).find("[placeholder]").each(function(){var a=$(this);a.val()===a.attr("placeholder")&&a.val("")})})),A(g,h,i),o.find(".action-hallway, .banner-hallway").length&&CASS.load("hallway"),$("iframe[src*='youtube']").each(function(){var a=$(this),b=a.outerWidth(),c=a.parent();c.hasClass("embed-container")||a.wrap('<div class="embed-wrapper" style="width:'+b+'px"><div class="embed-container"></div></div>')}),s.length&&c({load:"lib/backbone/underscore.js",complete:function(){C(s)}}),t.length&&c({load:["lib/shadowbox/shadowbox.js"],complete:function(){w()}})},Q=function(){n("CASS ready (we are in "+document.compatMode+")"),$(function(){P(),O(),B(),z(),D()})};return{init:Q,load:o,debug:n,setVersion:p,setGaAccount:q,isEven:s,getUrlVars:t,objectSize:r,getWindowWidth:u,s1Server:h,isCass:k,isBunhill:l}}(window,Modernizr,yepnope);
//# sourceMappingURL=js/map/source-map.js